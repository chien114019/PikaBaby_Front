<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è³¼ç‰©è»Š - PikaBaby</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/nav.css">
    <style>
        /* è³¼ç‰©è»Šæ¨£å¼ */
        .cart-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }

        .cart-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .cart-table th,
        .cart-table td {
            padding: 15px;
            text-align: center;
            vertical-align: middle;
            border-bottom: 1px solid #ddd;
        }

        .cart-item-image {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }

        .cart-item-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .product-info {
            text-align: left;
        }

        .product-name {
            font-size: 1.1em;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .product-specs {
            font-size: 0.9em;
            color: #666;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .quantity-btn {
            padding: 5px 10px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
        }

        .quantity-display {
            padding: 5px 15px;
            border: 1px solid #ddd;
            min-width: 50px;
            text-align: center;
        }

        .checkout-form-wrapper {
            min-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
            box-sizing: border-box;
        }

        .checkout-form {
            display: block;
            max-width: 700px;
            margin: 40px auto;
            background: #fff;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            border-radius: 12px;
            border: 1.5px solid #e0e0e0;
            padding: 32px 24px 24px 24px;
            text-align: center;
        }

        #checkoutForm {
            display: block;
            max-width: 700px;
            margin: 40px auto;
            background: none;
            box-shadow: none;
            border-radius: 0;
            padding: 0 16px;
            text-align: center;
        }

        #checkoutForm>* {
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }

        .order-summary,
        .checkout-addons,
        #orderForm {
            text-align: center;
        }

        #orderForm {
            margin-left: auto;
            margin-right: auto;
        }

        .order-summary {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            background: white;
            border-radius: 0;
            box-shadow: none;
            margin-bottom: 20px;
            padding: 20px 0;
        }

        .order-items {
            margin-bottom: 20px;
        }

        .order-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .order-item-image {
            width: 80px;
            height: 80px;
            margin-right: 15px;
        }

        .order-item-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .order-item-details {
            flex-grow: 1;
        }

        .order-item-price {
            text-align: right;
            min-width: 100px;
        }

        .total-section {
            text-align: right;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        .checkout-addons {
            width: 100%;
            margin: 30px 0 0 0;
            background: #fffbe6;
            border-radius: 8px;
            padding: 20px 10px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
            text-align: center;
        }

        .checkout-addons-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 16px;
        }

        .checkout-addon-list {
            display: flex;
            justify-content: center;
            gap: 24px;
            flex-wrap: wrap;
        }

        .checkout-addon-item {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
            padding: 12px 16px;
            width: 160px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .checkout-addon-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .checkout-addon-item button {
            margin-top: 8px;
        }

        .checkout-addon-item button:disabled {
            background: #ccc !important;
            border-color: #ccc !important;
            cursor: not-allowed;
        }

        .cart-main-row {
            display: flex;
            align-items: flex-start;
            gap: 40px;
        }

        #cartContent {
            flex: 1 1 0%;
        }

        .recommendations {
            flex: 0 0 300px;
            min-width: 250px;
            margin-left: auto;
            text-align: right;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        @media (max-width: 900px) {
            .cart-main-row {
                flex-direction: column;
            }

            .recommendations {
                margin-left: 0;
                text-align: center;
            }
        }
    </style>
</head>

<body>
    <header>
        <!-- ç½®é ‚çš„ä¿ƒéŠ·è¨Šæ¯ -->
        <div class="top-banner">
            æ¯é€±äº”å…­æ—¥ğŸ”¥æ–°äººä»£ç†å¯„è³£å…é‹
            <font color="red">25 æ—¥ 23 æ™‚ 14 åˆ† 35 ç§’</font>
            <div style="display: inline-block; background-color: black; color: white">
                Ispian love you
            </div>
        </div>

        <!-- LOGO -->
        <div class="nav-logo-row">
            <img src="../images/logo-pikababy.png" alt="PikaBaby" class="nav-logo" />
        </div>
    </header>

    <!-- å°è¦½åˆ— -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <!-- <div class="collapse navbar-collapse justify-content-center d-flex" id="navbarSupportedContent"> -->
            <div class="collapse navbar-collapse justify-content-around d-flex" id="navbarSupportedContent">
                <!-- LOGO -->
                <img src="../images/logo-pikababy.png" alt="PikaBaby"
                    style="height: 80px; width: 0px; transition: 3s; display: none;" />
                <ul class="navbar-nav ml-auto nav-links gap-5 me-0">
                    <li class="nav-item d-flex align-items-center">
                        <a href="../index.html">é¦–é </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdown1" role="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            å¹´é½¡å€é–“(0-3M)
                        </a>
                        <div class="dropdown-menu p-3 justify-content-center" aria-labelledby="navbarDropdown1">
                            <a class="dropdown-item" href="../Products/product.html?category=feeding">å¥¶ç“¶/å¥¶å˜´</a>
                            <a class="dropdown-item" href="../Products/product.html?category=clothes">åœå…œ/æ¹å·¾</a>
                            <a class="dropdown-item" href="../Products/product.html?category=clothes">å¬°å…’æœè£</a>
                            <a class="dropdown-item" href="../Products/product.html?category=care">æ¸…æ½”ç”¨å“</a>
                            <a class="dropdown-item" href="../Products/product.html?category=stroller">å¬°å…’æ¨è»Š</a>
                            <a class="dropdown-item" href="../Products/product.html?category=furniture">å¬°å…’åºŠ</a>
                            <a class="dropdown-item" href="../Products/product.html?category=feeding">å“ºä¹³ç”¨å“</a>
                            <a class="dropdown-item" href="../Products/product.html?category=care">å¬°å…’ç”¨å“</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdown2" role="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            å¹´é½¡å€é–“(3-6M)
                        </a>
                        <div class="dropdown-menu p-3 justify-content-center" aria-labelledby="navbarDropdown2">
                            <a class="dropdown-item" href="../Products/product.html?category=clothes">å¬°å…’æœè£</a>
                            <a class="dropdown-item" href="../Products/product.html?category=toys">ç©å…·</a>
                            <a class="dropdown-item" href="../Products/product.html?category=stroller">å¬°å…’æ¨è»Š</a>
                            <a class="dropdown-item" href="../Products/product.html?category=furniture">å¬°å…’åºŠ</a>
                            <a class="dropdown-item" href="../Products/product.html?category=car-seat">æ±½åº§</a>
                            <a class="dropdown-item" href="../Products/product.html?category=care">å¬°å…’ç”¨å“</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdown3" role="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            å¹´é½¡å€é–“(6-12M)
                        </a>
                        <div class="dropdown-menu p-3 justify-content-center" aria-labelledby="navbarDropdown3">
                            <a class="dropdown-item" href="../Products/product.html?category=walking">å­¸æ­¥ç”¨å“</a>
                            <a class="dropdown-item" href="../Products/product.html?category=dining">é¤å…·ç”¨å“</a>
                            <a class="dropdown-item" href="../Products/product.html?category=clothes">å¹¼å…’æœè£</a>
                            <a class="dropdown-item" href="../Products/product.html?category=toys">ç©å…·</a>
                            <a class="dropdown-item" href="../Products/product.html?category=stroller">å¬°å…’æ¨è»Š</a>
                            <a class="dropdown-item" href="../Products/product.html?category=car-seat">æ±½åº§</a>
                            <a class="dropdown-item" href="../Products/product.html?category=care">å¬°å…’ç”¨å“</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdown4" role="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            å¹´é½¡å€é–“(2-3y)
                        </a>
                        <div class="dropdown-menu p-3 justify-content-center" aria-labelledby="navbarDropdown4">
                            <a class="dropdown-item" href="../Products/product.html?category=education">å¹¼æ•™ç”¨å“</a>
                            <a class="dropdown-item" href="../Products/product.html?category=clothes">å…’ç«¥æœè£</a>
                            <a class="dropdown-item" href="../Products/product.html?category=toys">ç©å…·</a>
                            <a class="dropdown-item" href="../Products/product.html?category=car-seat">æ±½åº§</a>
                            <a class="dropdown-item" href="../Products/product.html?category=stroller">å…’ç«¥æ¨è»Š</a>
                            <a class="dropdown-item" href="../Products/product.html?category=furniture">é¤æ¤…</a>
                            <a class="dropdown-item" href="../Products/product.html?category=appliance">é›»å™¨ç”¨å“</a>
                            <a class="dropdown-item" href="../Products/product.html?category=care">å¬°å…’ç”¨å“</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdown5" role="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            äºŒæ‰‹è¨—å”®
                        </a>
                        <div class="dropdown-menu p-3 justify-content-center gap-5" aria-labelledby="navbarDropdown5">
                            <a class="dropdown-item" href="Secondhand/consign.html">è¨—å”®æœå‹™</a>
                            <a class="dropdown-item" href="Secondhand/consign_apply.html">äºŒæ‰‹è¨—å”®ç”³è«‹</a>
                            <a class="dropdown-item" href="Secondhand/consign_search.html">è¨—å”®ç´€éŒ„æŸ¥è©¢</a>
                            <a class="dropdown-item" href="Secondhand/withdraw_apply.html">è¨—å”®ææ¬¾ç”³è«‹</a>
                            <a class="dropdown-item" href="Secondhand/withdraw_search.html">ææ¬¾ç´€éŒ„æŸ¥è©¢</a>
                        </div>
                    </li>
                    <li class="nav-item d-flex align-items-center">
                        <a href="../about.html">é—œæ–¼æˆ‘å€‘</a>
                    </li>
                    <ul class="d-flex gap-3">
                        <!-- <li class="nav-item d-flex align-items-center">
                            <a class="fs-5" href="../Shopping/shoppingcart.html">ğŸ›’</a>
                        </li> -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" id="navbarDropdown5" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                ğŸ›’
                            </a>
                            <div class="dropdown-menu p-3 justify-content-center gap-5"
                                aria-labelledby="navbarDropdown5">
                                <a class="dropdown-item" href="../Shopping/shoppingcart.html">è³¼ç‰©è»Š</a>
                                <a class="dropdown-item" href="../Shopping/order.html">è¨‚å–®æŸ¥è©¢</a>
                            </div>
                        </li>
                        <li class="nav-item d-flex align-items-center">
                            <a class="fs-5" href="../Member/login.html">ğŸ‘¤</a>
                        </li>
                    </ul>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹ -->
    <main style="background: #fff; padding: 20px 0; min-height: fit-content;">
        <div class="cart-container">
            <div class="cart-main-row">
                <!-- è³¼ç‰©è»Šå…§å®¹ -->
                <div id="cartContent">
                    <h2 style="color: rgb(226, 190, 44);">è³¼ç‰©è»Š</h2>
                    <table class="cart-table" id="cart-table">
                        <thead>
                            <tr>
                                <th>å•†å“åœ–ç‰‡</th>
                                <th>å•†å“åç¨±</th>
                                <th>å–®åƒ¹</th>
                                <th>æ•¸é‡</th>
                                <th>å°è¨ˆ</th>
                                <th>åˆªé™¤</th>
                            </tr>
                        </thead>
                        <tbody id="cart-items"></tbody>
                    </table>
                    <div id="cart-total"></div>
                    <div class="text-end">
                        <button class="btn btn-primary" onclick="showCheckoutForm()">å‰å¾€çµå¸³</button>
                    </div>
                </div>
            </div>
            <!-- çµå¸³è¡¨å–®ç§»å‡º cart-main-rowï¼Œç›´æ¥æ”¾åœ¨ cart-container ä¸‹æ–¹ -->
            <div id="checkoutForm" style="display: none;">
                <h2 style="text-align:center;">çµå¸³è³‡è¨Š</h2>
                <!-- è¨‚å–®æ‘˜è¦ -->
                <div class="order-summary">
                    <h4 style="text-align:center;">è¨‚å–®æ˜ç´°</h4>
                    <div id="orderItems" class="order-items">
                        <!-- è¨‚å–®é …ç›®å°‡åœ¨é€™è£¡å‹•æ…‹æ·»åŠ  -->
                    </div>
                    <div class="total-section">
                        <div class="mb-2">å•†å“ç¸½é¡ï¼š<span id="orderSubtotal">0</span> å…ƒ</div>
                        <div class="mb-2">é‹è²»ï¼š<span id="shippingFee">0</span> å…ƒ</div>
                        <div class="mb-2">å„ªæƒ æŠ˜æ‰£ï¼š<span id="discount">0</span> å…ƒ</div>
                        <div class="mb-2">
                            <label for="points">ä½¿ç”¨æœƒå“¡é»æ•¸æŠ˜åƒ¹ (1é»æŠ˜1å…ƒ)ï¼š</label>
                            <input type="number" id="points" min="0" value="0" onchange="updateTotal()"
                                style="width: 80px;">
                            <span style="margin-left:8px;color:#e6b800;">å‰©é¤˜é»æ•¸ï¼š<span id="availablePoints">100</span>
                                é»</span>
                        </div>
                        <div class="h5">æ‡‰ä»˜ç¸½é¡ï¼š<span id="orderTotal">0</span> å…ƒ</div>
                    </div>
                </div>

                <!-- åŠ è³¼å•†å“é¸é … -->
                <div class="checkout-addons">
                    <div class="checkout-addons-title">åŠ è³¼å•†å“æ¨è–¦</div>
                    <div class="checkout-addon-list">
                        <div class="checkout-addon-item">
                            <img src="../images/product44.jpg" alt="åŠ è³¼å•†å“A">
                            <div>åŠ è³¼å•†å“A</div>
                            <div>NT$ 99</div>
                            <button class="btn btn-sm btn-primary" id="addonA-btn"
                                onclick="addAddonToCart('åŠ è³¼å•†å“A', 99, '../images/product44.jpg', this)">åŠ å…¥è³¼ç‰©è»Š</button>
                        </div>
                        <div class="checkout-addon-item">
                            <img src="../images/product12.jpg" alt="åŠ è³¼å•†å“B">
                            <div>åŠ è³¼å•†å“B</div>
                            <div>NT$ 150</div>
                            <button class="btn btn-sm btn-primary" id="addonB-btn"
                                onclick="addAddonToCart('åŠ è³¼å•†å“B', 150, '../images/product12.jpg', this)">åŠ å…¥è³¼ç‰©è»Š</button>
                        </div>
                    </div>
                </div>

                <!-- æ”¶ä»¶è³‡è¨Šè¡¨å–® -->
                <form id="orderForm" onsubmit="submitOrder(event)" style="width:100%;max-width:600px;margin:0 auto;">
                    <div class="mb-3">
                        <label class="form-label">æ”¶ä»¶äººå§“å</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">è¯çµ¡é›»è©±</label>
                        <input type="tel" class="form-control" name="phone" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">æ”¶ä»¶åœ°å€</label>
                        <input type="text" class="form-control" name="address" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ä»˜æ¬¾æ–¹å¼</label>
                        <select class="form-select" name="paymentMethod" required>
                            <option value="">è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼</option>
                            <option value="credit">ä¿¡ç”¨å¡</option>
                            <option value="transfer">éŠ€è¡Œè½‰å¸³</option>
                            <option value="linepay">LINE Pay</option>
                        </select>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-secondary me-2" onclick="hideCheckoutForm()">è¿”å›è³¼ç‰©è»Š</button>
                        <button type="submit" class="btn btn-primary">ç¢ºèªé€å‡º</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- é å°¾ -->
    <footer>
        <div class="footer-container align-items-center">
            <div class="footer-section" style="flex: 0;">
                <img src="../images/logo-pikababy.png" alt="PikaBaby" class="footer-logo" />
            </div>
            <div class="footer-section w-100">
                <p class="footer-title">PikaBaby</p>
                <div class="footer-line"></div>
                <p class="mb-1">æœå‹™æˆ‘å€‘</p>
                <p class="mb-1">å“ç‰Œç‰¹è‰²</p>
            </div>
            <div class="footer-section w-100">
                <h3>å“ç‰Œæœå‹™</h3>
                <div class="footer-line"></div>
                <p class="mb-1">Baby Store</p>
                <p class="mb-1">äºŒæ‰‹å•†åŸ</p>
            </div>
            <div class="footer-section w-100">
                <h3>è¯çµ¡æˆ‘å€‘</h3>
                <div class="footer-line"></div>
                <p class="mb-1">è¯çµ¡é›»è©±ï¼š(04) 2326-5860</p>
                <p class="mb-1">è¯çµ¡åœ°å€ï¼šå°ä¸­å¸‚å—å±¯å€å…¬ç›Šè·¯äºŒæ®µ51è™Ÿ18æ¨“</p>
            </div>
        </div>
    </footer>

    <!-- å¥¶ç“¶ -->
    <div class="floating-bottle"></div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/navbar.js"></script>
    <script>
        let cartItems = [];

        // ç•¶é é¢åŠ è¼‰æ™‚åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function () {
            loadCart();
            // æª¢æŸ¥æ˜¯å¦éœ€è¦ç›´æ¥é¡¯ç¤ºçµå¸³è¡¨å–®
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('checkout') === 'true') {
                showCheckoutForm();
            }
            const availablePoints = 100; // å‡è¨­æœƒå“¡é»æ•¸
            const pointsSpan = document.getElementById('availablePoints');
            if (pointsSpan) pointsSpan.textContent = availablePoints;
            // æª¢æŸ¥åŠ è³¼å•†å“æŒ‰éˆ•ç‹€æ…‹
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (cart.find(item => item.name === 'åŠ è³¼å•†å“A')) {
                const btnA = document.getElementById('addonA-btn');
                if (btnA) { btnA.disabled = true; btnA.textContent = 'å·²åŠ å…¥è³¼ç‰©è»Š'; }
            }
            if (cart.find(item => item.name === 'åŠ è³¼å•†å“B')) {
                const btnB = document.getElementById('addonB-btn');
                if (btnB) { btnB.disabled = true; btnB.textContent = 'å·²åŠ å…¥è³¼ç‰©è»Š'; }
            }
        });

        // å¾ localStorage åŠ è¼‰è³¼ç‰©è»Šæ•¸æ“š
        function loadCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartContainer = document.getElementById('cart-items');
            cartContainer.innerHTML = '';
            let total = 0;
            if (cart.length === 0) {
                cartContainer.innerHTML = '<tr><td colspan="6">è³¼ç‰©è»Šæ˜¯ç©ºçš„</td></tr>';
            } else {
                cart.forEach((item, idx) => {
                    const imgSrc = item.image && item.image.trim() !== '' ? item.image : 'https://via.placeholder.com/80x80?text=No+Image';
                    const row = document.createElement('tr');
                    row.innerHTML = `
              <td><img src="${imgSrc}" alt="${item.name}" style="width:60px;height:60px;object-fit:cover;border-radius:8px;"></td>
              <td>${item.name}</td>
              <td>NT$${item.price}</td>
              <td>
                <button onclick="updateQuantity(${idx}, -1)" class="btn btn-sm btn-outline-secondary">-</button>
                <span style="margin:0 8px;">${item.quantity}</span>
                <button onclick="updateQuantity(${idx}, 1)" class="btn btn-sm btn-outline-secondary">+</button>
              </td>
              <td>NT$${item.price * item.quantity}</td>
              <td><button onclick="removeItem(${idx})"  class="btn btn-danger">åˆªé™¤</button></td>
            `;
                    cartContainer.appendChild(row);
                    total += item.price * item.quantity;
                });
            }
            document.getElementById('cart-total').textContent = `ç¸½è¨ˆï¼šNT$ ${total}`;
        }

        function updateQuantity(idx, delta) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart[idx].quantity = Math.max(1, cart[idx].quantity + delta);
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
        }

        function removeItem(idx) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å•†å“å—ï¼Ÿ')) {
                let cart = JSON.parse(localStorage.getItem('cart')) || [];
                cart.splice(idx, 1);
                localStorage.setItem('cart', JSON.stringify(cart));
                loadCart();
            }
        }

        function goToCheckout() {
            window.location.href = 'checkout.html';
        }

        // é¡¯ç¤ºçµå¸³è¡¨å–®
        function showCheckoutForm() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (cart.length === 0) {
                alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼');
                return;
            }
            renderOrderItems(cart);
            document.getElementById('cartContent').style.display = 'none';
            document.getElementById('checkoutForm').style.display = 'block';
            showPointsPrompt();
        }

        // æ¸²æŸ“çµå¸³æ˜ç´°
        function renderOrderItems(cart) {
            const orderItems = document.getElementById('orderItems');
            orderItems.innerHTML = '';
            let subtotal = 0;
            cart.forEach((item, idx) => {
                const imgSrc = item.image && item.image.trim() !== '' ? item.image : 'https://via.placeholder.com/80x80?text=No+Image';
                const orderItem = document.createElement('div');
                orderItem.className = 'order-item';
                orderItem.innerHTML = `
            <div class="order-item-image">
              <img src="${imgSrc}" alt="${item.name}">
            </div>
            <div class="order-item-details">
              <div class="product-name">${item.name}</div>
              <div class="product-specs">
                <button onclick="updateOrderItemQuantity(${idx}, -1)" class="btn btn-sm btn-outline-secondary">-</button>
                <span style="margin:0 8px;">${item.quantity}</span>
                <button onclick="updateOrderItemQuantity(${idx}, 1)" class="btn btn-sm btn-outline-secondary">+</button>
                <button onclick="removeOrderItem(${idx})" class="btn btn-sm btn-danger ms-2">åˆªé™¤</button>
              </div>
            </div>
            <div class="order-item-price">
              NT$${item.price * item.quantity}
            </div>
          `;
                orderItems.appendChild(orderItem);
                subtotal += item.price * item.quantity;
            });
            document.getElementById('orderSubtotal').textContent = subtotal;
            document.getElementById('orderTotal').textContent = subtotal;
            document.getElementById('shippingFee').textContent = 0;
            document.getElementById('discount').textContent = 0;
            updateTotal();
        }

        // çµå¸³æ˜ç´°å¢æ¸›æ•¸é‡
        function updateOrderItemQuantity(idx, delta) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart[idx].quantity = Math.max(1, cart[idx].quantity + delta);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderOrderItems(cart);
            updateTotal();
        }

        // çµå¸³æ˜ç´°åˆªé™¤
        function removeOrderItem(idx) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å•†å“å—ï¼Ÿ')) {
                let cart = JSON.parse(localStorage.getItem('cart')) || [];
                cart.splice(idx, 1);
                localStorage.setItem('cart', JSON.stringify(cart));
                renderOrderItems(cart);
                updateTotal();
            }
        }

        // éš±è—çµå¸³è¡¨å–®
        function hideCheckoutForm() {
            document.getElementById('cartContent').style.display = 'block';
            document.getElementById('checkoutForm').style.display = 'none';
        }

        // æäº¤è¨‚å–®
        async function submitOrder(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const orderData = {
                name: formData.get('name'),
                phone: formData.get('phone'),
                email: formData.get('email'),
                address: formData.get('address'),
                paymentMethod: formData.get('paymentMethod'),
                totalAmount: parseFloat(document.getElementById('orderTotal').textContent.replace(/[^0-9.-]+/g, '')),
                items: cart.map(item => ({
                    name: item.name,
                    quantity: item.quantity,
                    price: item.price
                }))
            };
            try {
                const response = await fetch('http://localhost:8080/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                if (response.ok) {
                    const result = await response.json();
                    alert('è¨‚å–®å·²æˆåŠŸå»ºç«‹ï¼è¨‚å–®ç·¨è™Ÿï¼š' + result.orderId);
                    localStorage.setItem('cart', JSON.stringify([]));
                    window.location.href = `order-confirmation.html?orderId=${result.orderId}`;
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'è¨‚å–®å»ºç«‹å¤±æ•—');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('è¨‚å–®å»ºç«‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼š' + error.message);
            }
        }

        function updateTotal() {
            const subtotal = parseFloat(document.getElementById('orderSubtotal').textContent);
            const shippingFee = parseFloat(document.getElementById('shippingFee').textContent);
            const discount = parseFloat(document.getElementById('discount').textContent);
            const points = parseInt(document.getElementById('points').value) || 0;
            const total = subtotal + shippingFee - discount - points;
            document.getElementById('orderTotal').textContent = total;
        }



        // åŠ è³¼å•†å“åŠ å…¥è³¼ç‰©è»Šï¼ˆçµå¸³é å°ˆç”¨ï¼‰
        function addAddonToCart(productName, price, imageUrl, btn) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const idx = cart.findIndex(item => item.name === productName);
            if (idx > -1) {
                cart[idx].quantity += 1;
            } else {
                cart.push({ name: productName, price: price, quantity: 1, image: imageUrl });
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            alert(`å·²å°‡ ${productName} åŠ å…¥è³¼ç‰©è»Šï¼`);
            loadCart();
            renderOrderItems(cart);
            updateTotal();
            // æŒ‰éˆ•è®Šæˆå·²åŠ å…¥ä¸”ä¸èƒ½å†é»
            if (btn) {
                btn.disabled = true;
                btn.textContent = 'å·²åŠ å…¥è³¼ç‰©è»Š';
            }
        }

        // ç¯©é¸åŠŸèƒ½
        function filterProducts(category) {
            // æ›´æ–° URL åƒæ•¸
            const url = new URL(window.location.href);
            url.searchParams.set('category', category);
            window.history.pushState({}, '', url);

            // å¦‚æœç•¶å‰é é¢ä¸æ˜¯å•†å“é é¢ï¼Œå‰‡è·³è½‰åˆ°å•†å“é é¢
            if (!window.location.pathname.includes('product.html')) {
                window.location.href = `product.html?category=${category}`;
            }
        }
    </script>
</body>

</html>