<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>LINE Pay æ¸¬è©¦é </title>
</head>
<body>
  <h1>ğŸ§ª LINE Pay æ¸¬è©¦å·¥å…·</h1>

  <form id="payForm">
    <label>è¨‚å–® IDï¼š<input type="text" id="orderId" required value="ORDER123" /></label><br>
    <label>ä»˜æ¬¾é‡‘é¡ï¼š<input type="number" id="amount" required value="300" /></label><br>
    <label>å•†å“åç¨±ï¼š<input type="text" id="productName" required value="å¯¶å¯¶æ¨è»Š" /></label><br>
    <button type="submit">é€å‡ºä»˜æ¬¾</button>
  </form>

  <h3>ğŸ”„ è«‹æ±‚è³‡æ–™ï¼š</h3>
  <pre id="requestOutput"></pre>

  <h3>ğŸ“¥ LINE Pay å›æ‡‰ï¼š</h3>
  <pre id="responseOutput"></pre>

  <script>
    document.getElementById("payForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const orderId = document.getElementById("orderId").value;
      const amount = parseInt(document.getElementById("amount").value);
      const productName = document.getElementById("productName").value;

      const form = {
        orderId: orderId,
        amount: amount,
        currency: "TWD",
        packages: [
          {
            id: "PKG1",
            name: "è¨‚å–®å•†å“åŒ…",
            amount: amount,
            products: [
              {
                name: productName,
                quantity: 1,
                price: amount
              }
            ]
          }
        ],
        redirectUrls: {
          confirmUrl: "http://localhost:8080/linepay/confirm",
          cancelUrl: "http://localhost:8080/linepay/cancel"
        }
      };

      document.getElementById("requestOutput").textContent = JSON.stringify(form, null, 2);

      try {
        const res = await fetch("http://localhost:8080/linepay/request", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(form)
        });

        const data = await res.json();
        document.getElementById("responseOutput").textContent = JSON.stringify(data, null, 2);

        if (data.info?.paymentUrl?.web) {
          window.location.href = data.info.paymentUrl.web;
        }
      } catch (err) {
        document.getElementById("responseOutput").textContent = "âŒ ç™¼é€å¤±æ•—ï¼š" + err.message;
      }
    });
  </script>
</body>
</html>
