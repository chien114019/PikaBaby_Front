<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>è³¼ç‰©è»Š API æ¸¬è©¦</title>
</head>

<body>
    <h1>ğŸ§ª è³¼ç‰©è»Š API æ¸¬è©¦å·¥å…·</h1>

    <button id="sendTestOrder">ç™¼é€æ¸¬è©¦è¨‚å–®</button>

    <h2>ğŸ“¤ Request</h2>
    <pre id="requestOutput"></pre>

    <h2>ğŸ“¥ Response</h2>
    <pre id="responseOutput"></pre>

    <script>
        document.getElementById('sendTestOrder').addEventListener('click', async () => {
            const testOrder = {
                name: "æ¸¬è©¦ç”¨æˆ¶",
                phone: "0912345678",
                email: "test@example.com",
                address: "å°åŒ—å¸‚ä¿¡ç¾©å€",
                paymentMethod: "ä¿¡ç”¨å¡",
                pointsUsed: 10,
                items: [
                    { productId: 39, quantity: 1, price: 100 },
                    { productId: 40, quantity: 1, price: 200 }
                ]
            };

            document.getElementById('requestOutput').textContent =
                JSON.stringify(testOrder, null, 2);

            try {
                const response = await fetch("http://localhost:8080/orders/api/cart", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(testOrder)
                });

                const contentType = response.headers.get("content-type");
                let responseData;

                if (contentType && contentType.includes("application/json")) {
                    responseData = await response.json();
                } else {
                    responseData = await response.text();
                }

                document.getElementById('responseOutput').textContent =
                    typeof responseData === "string"
                        ? responseData
                        : JSON.stringify(responseData, null, 2);

                console.log("ğŸ“¡ Status:", response.status);
                console.log("ğŸ“¥ Response:", responseData);
            } catch (error) {
                document.getElementById('responseOutput').textContent =
                    "âŒ éŒ¯èª¤ï¼š" + error.message;
                console.error("âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š", error);
            }
        });

        const paymentRequest = {
            orderId: 123, // å¾ä½ å‰›å‰›å»ºç«‹çš„è¨‚å–® ID
            amount: 300,  // è¨‚å–®é‡‘é¡
            currency: "TWD",
            productName: "æ¸¬è©¦å•†å“",
            confirmUrl: "http://localhost:8080/linepay/confirm",  // ç¢ºèªé é¢
            cancelUrl: "http://localhost:8080/linepay/cancel"     // å–æ¶ˆé é¢
        };

        await fetch("http://localhost:8080/api/linepay/checkout", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(paymentRequest)
        });

    </script>
</body>

</html>